{
  "name": "æ™ºèƒ½è¿›åº¦è·Ÿè¸ªä¸æˆé•¿åˆ†æ",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "progress-analytics",
        "responseMode": "responseNode"
      },
      "id": "webhook-progress-trigger",
      "name": "è¿›åº¦åˆ†æè§¦å‘å™¨",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 400],
      "webhookId": "progress-analytics"
    },
    {
      "parameters": {
        "jsCode": "// å­¦ä¹ è¿›åº¦æ•°æ®åˆ†æ\nconst progressData = $input.all()[0].json;\nconst userId = progressData.userId;\nconst timeRange = progressData.timeRange || '30days';\nconst analysisType = progressData.analysisType || 'comprehensive';\n\n// æ¨¡æ‹Ÿç”¨æˆ·å­¦ä¹ æ•°æ®\nconst mockUserData = {\n  userId: userId,\n  totalStudyTime: 1250, // åˆ†é’Ÿ\n  poemsStudied: 15,\n  averageScore: 78,\n  strengths: ['ç†è§£èƒ½åŠ›', 'è®°å¿†åŠ›'],\n  weaknesses: ['å†™ä½œè¡¨è¾¾', 'æ–‡è¨€æ–‡è¯­æ³•'],\n  recentActivities: [\n    { date: '2025-07-19', poem: 'æ˜¥æ™“', score: 85, timeSpent: 45 },\n    { date: '2025-07-18', poem: 'é™å¤œæ€', score: 72, timeSpent: 38 },\n    { date: '2025-07-17', poem: 'çˆ±è²è¯´', score: 88, timeSpent: 52 },\n    { date: '2025-07-16', poem: 'å±±è¡Œ', score: 75, timeSpent: 35 },\n    { date: '2025-07-15', poem: 'ç™»é¹³é›€æ¥¼', score: 80, timeSpent: 42 }\n  ],\n  studyStreak: 12, // è¿ç»­å­¦ä¹ å¤©æ•°\n  achievements: [\n    'è¿ç»­å­¦ä¹ 10å¤©',\n    'å®Œæˆ5é¦–è¯—æ­Œå­¦ä¹ ',\n    'å¹³å‡åˆ†è¶…è¿‡75åˆ†'\n  ]\n};\n\n// è®¡ç®—å­¦ä¹ è¶‹åŠ¿\nconst scores = mockUserData.recentActivities.map(a => a.score);\nconst timeSpent = mockUserData.recentActivities.map(a => a.timeSpent);\n\nconst averageRecentScore = scores.reduce((a, b) => a + b, 0) / scores.length;\nconst totalRecentTime = timeSpent.reduce((a, b) => a + b, 0);\nconst averageStudyTime = totalRecentTime / timeSpent.length;\n\n// è¶‹åŠ¿åˆ†æ\nconst scoreTrend = scores.length >= 3 ? \n  (scores[scores.length-1] + scores[scores.length-2]) / 2 > \n  (scores[0] + scores[1]) / 2 ? 'improving' : 'declining' : 'stable';\n\nconst timeTrend = timeSpent.length >= 3 ?\n  (timeSpent[timeSpent.length-1] + timeSpent[timeSpent.length-2]) / 2 > \n  (timeSpent[0] + timeSpent[1]) / 2 ? 'increasing' : 'decreasing' : 'stable';\n\n// å­¦ä¹ æ•ˆç‡åˆ†æ\nconst efficiency = averageRecentScore / averageStudyTime; // åˆ†æ•°/åˆ†é’Ÿ\nconst efficiencyLevel = efficiency > 2 ? 'high' : efficiency > 1.5 ? 'medium' : 'low';\n\n// ç”Ÿæˆæ´å¯Ÿå’Œå»ºè®®\nconst insights = [];\nconst recommendations = [];\n\nif (scoreTrend === 'improving') {\n  insights.push('å­¦ä¹ æˆç»©å‘ˆä¸Šå‡è¶‹åŠ¿ï¼Œä¿æŒå¾—å¾ˆå¥½ï¼');\n  recommendations.push('ç»§ç»­å½“å‰çš„å­¦ä¹ æ–¹æ³•');\n} else if (scoreTrend === 'declining') {\n  insights.push('æœ€è¿‘æˆç»©æœ‰æ‰€ä¸‹é™ï¼Œéœ€è¦è°ƒæ•´å­¦ä¹ ç­–ç•¥');\n  recommendations.push('å›é¡¾ä¹‹å‰çš„é”™è¯¯ï¼ŒåŠ å¼ºè–„å¼±ç¯èŠ‚');\n}\n\nif (timeTrend === 'increasing') {\n  insights.push('å­¦ä¹ æŠ•å…¥æ—¶é—´åœ¨å¢åŠ ï¼Œå¾ˆæœ‰å­¦ä¹ çƒ­æƒ…');\n} else if (timeTrend === 'decreasing') {\n  insights.push('å­¦ä¹ æ—¶é—´åœ¨å‡å°‘ï¼Œæ³¨æ„ä¿æŒå­¦ä¹ ä¹ æƒ¯');\n  recommendations.push('åˆ¶å®šæ›´ç¨³å®šçš„å­¦ä¹ è®¡åˆ’');\n}\n\nif (efficiencyLevel === 'high') {\n  insights.push('å­¦ä¹ æ•ˆç‡å¾ˆé«˜ï¼Œèƒ½å¤Ÿå¿«é€ŸæŒæ¡çŸ¥è¯†');\n} else if (efficiencyLevel === 'low') {\n  insights.push('å­¦ä¹ æ•ˆç‡å¯ä»¥æå‡ï¼Œå»ºè®®ä¼˜åŒ–å­¦ä¹ æ–¹æ³•');\n  recommendations.push('å°è¯•ä¸åŒçš„å­¦ä¹ æŠ€å·§ï¼Œå¦‚æ€ç»´å¯¼å›¾ã€è®°å¿†æ³•ç­‰');\n}\n\nif (mockUserData.studyStreak >= 10) {\n  insights.push(`å·²è¿ç»­å­¦ä¹ ${mockUserData.studyStreak}å¤©ï¼Œå­¦ä¹ ä¹ æƒ¯å¾ˆå¥½ï¼`);\n} else if (mockUserData.studyStreak < 5) {\n  recommendations.push('å»ºè®®ä¿æŒæ¯æ—¥å­¦ä¹ ï¼ŒåŸ¹å…»è‰¯å¥½ä¹ æƒ¯');\n}\n\nreturn {\n  success: true,\n  data: {\n    userId: userId,\n    analysisDate: new Date().toISOString(),\n    timeRange: timeRange,\n    summary: {\n      totalStudyTime: mockUserData.totalStudyTime,\n      poemsStudied: mockUserData.poemsStudied,\n      averageScore: mockUserData.averageScore,\n      studyStreak: mockUserData.studyStreak,\n      achievements: mockUserData.achievements\n    },\n    trends: {\n      scoresTrend: scoreTrend,\n      timeTrend: timeTrend,\n      efficiency: efficiencyLevel,\n      recentAverageScore: Math.round(averageRecentScore),\n      averageStudyTime: Math.round(averageStudyTime)\n    },\n    strengths: mockUserData.strengths,\n    weaknesses: mockUserData.weaknesses,\n    insights: insights,\n    recommendations: recommendations,\n    recentActivities: mockUserData.recentActivities\n  }\n};"
      },
      "id": "analyze-progress",
      "name": "å­¦ä¹ è¿›åº¦åˆ†æ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [460, 400]
    },
    {
      "parameters": {
        "jsCode": "// ç”Ÿæˆä¸ªæ€§åŒ–æˆé•¿æŠ¥å‘Š\nconst analysisData = $input.all()[0].json;\nconst summary = analysisData.summary;\nconst trends = analysisData.trends;\nconst strengths = analysisData.strengths;\nconst weaknesses = analysisData.weaknesses;\n\n// è®¡ç®—å­¦ä¹ ç­‰çº§\nconst totalExperience = summary.poemsStudied * 100 + summary.averageScore * 10;\nconst level = Math.floor(totalExperience / 1000) + 1;\nconst nextLevelExp = (level * 1000) - totalExperience;\n\n// ç”Ÿæˆå¾½ç« ç³»ç»Ÿ\nconst badges = [];\nif (summary.studyStreak >= 7) badges.push({ name: 'åšæŒå­¦ä¹ ', icon: 'ğŸ†', description: 'è¿ç»­å­¦ä¹ 7å¤©' });\nif (summary.studyStreak >= 30) badges.push({ name: 'å­¦ä¹ è¾¾äºº', icon: 'ğŸŒŸ', description: 'è¿ç»­å­¦ä¹ 30å¤©' });\nif (summary.averageScore >= 80) badges.push({ name: 'ä¼˜ç§€å­¦è€…', icon: 'ğŸ“', description: 'å¹³å‡åˆ†è¶…è¿‡80åˆ†' });\nif (summary.poemsStudied >= 10) badges.push({ name: 'åšè§ˆç¾¤ä¹¦', icon: 'ğŸ“š', description: 'å­¦ä¹ è¶…è¿‡10é¦–è¯—è¯' });\nif (summary.totalStudyTime >= 1200) badges.push({ name: 'æ—¶é—´å¤§å¸ˆ', icon: 'â°', description: 'ç´¯è®¡å­¦ä¹ è¶…è¿‡20å°æ—¶' });\n\n// æˆé•¿é‡Œç¨‹ç¢‘\nconst milestones = [\n  { requirement: 'å­¦ä¹ 5é¦–è¯—è¯', achieved: summary.poemsStudied >= 5, reward: 'è§£é”è¯—è¯é‰´èµ' },\n  { requirement: 'è¿ç»­å­¦ä¹ 14å¤©', achieved: summary.studyStreak >= 14, reward: 'è§£é”å­¦ä¹ è®¡åˆ’å®šåˆ¶' },\n  { requirement: 'å¹³å‡åˆ†è¾¾åˆ°85åˆ†', achieved: summary.averageScore >= 85, reward: 'è§£é”é«˜çº§åˆ†æåŠŸèƒ½' },\n  { requirement: 'ç´¯è®¡å­¦ä¹ 30å°æ—¶', achieved: summary.totalStudyTime >= 1800, reward: 'è§£é”å¯¼å¸ˆæ¨¡å¼' }\n];\n\n// ä¸‹ä¸€é˜¶æ®µç›®æ ‡\nconst nextGoals = [];\nif (summary.averageScore < 90) {\n  nextGoals.push({ goal: 'æå‡å¹³å‡åˆ†åˆ°90åˆ†', progress: summary.averageScore / 90 * 100, tips: 'å¤šåšç»ƒä¹ é¢˜ï¼ŒåŠ å¼ºç†è§£' });\n}\nif (summary.poemsStudied < 20) {\n  nextGoals.push({ goal: 'å­¦ä¹ 20é¦–ç»å…¸è¯—è¯', progress: summary.poemsStudied / 20 * 100, tips: 'æ¯å¤©è‡³å°‘å­¦ä¹ ä¸€é¦–æ–°è¯—è¯' });\n}\nif (summary.studyStreak < 21) {\n  nextGoals.push({ goal: 'è¿ç»­å­¦ä¹ 21å¤©', progress: summary.studyStreak / 21 * 100, tips: 'ä¿æŒæ¯æ—¥å­¦ä¹ ä¹ æƒ¯' });\n}\n\n// å­¦ä¹ å»ºè®®\nconst personalizedSuggestions = [];\n\nif (trends.scoresTrend === 'declining') {\n  personalizedSuggestions.push({\n    type: 'improvement',\n    title: 'æˆç»©æå‡å»ºè®®',\n    content: 'å»ºè®®å¤ä¹ ä¹‹å‰å­¦è¿‡çš„å†…å®¹ï¼Œå·©å›ºåŸºç¡€çŸ¥è¯†',\n    action: 'å›é¡¾é”™é¢˜é›†'\n  });\n}\n\nif (trends.efficiency === 'low') {\n  personalizedSuggestions.push({\n    type: 'efficiency',\n    title: 'å­¦ä¹ æ•ˆç‡ä¼˜åŒ–',\n    content: 'å°è¯•ç•ªèŒ„å·¥ä½œæ³•ï¼Œ25åˆ†é’Ÿä¸“æ³¨å­¦ä¹ +5åˆ†é’Ÿä¼‘æ¯',\n    action: 'è°ƒæ•´å­¦ä¹ æ–¹æ³•'\n  });\n}\n\nif (weaknesses.includes('å†™ä½œè¡¨è¾¾')) {\n  personalizedSuggestions.push({\n    type: 'skill',\n    title: 'å†™ä½œèƒ½åŠ›æå‡',\n    content: 'å¤šç»ƒä¹ ä»¿å†™å’Œåˆ›ä½œï¼Œä»æ¨¡ä»¿å¼€å§‹é€æ­¥æé«˜',\n    action: 'å‚åŠ å†™ä½œç»ƒä¹ '\n  });\n}\n\n// åŒä¼´æ¯”è¾ƒï¼ˆåŒ¿ååŒ–ï¼‰\nconst peerComparison = {\n  averageScore: {\n    user: summary.averageScore,\n    peer: 73, // åŒçº§åˆ«ç”¨æˆ·å¹³å‡åˆ†\n    percentile: summary.averageScore > 73 ? 75 : 45\n  },\n  studyTime: {\n    user: summary.totalStudyTime,\n    peer: 980,\n    percentile: summary.totalStudyTime > 980 ? 80 : 40\n  }\n};\n\nreturn {\n  success: true,\n  data: {\n    ...analysisData,\n    growthReport: {\n      level: level,\n      nextLevelExp: nextLevelExp,\n      levelProgress: ((totalExperience % 1000) / 1000) * 100,\n      badges: badges,\n      milestones: milestones,\n      nextGoals: nextGoals,\n      personalizedSuggestions: personalizedSuggestions,\n      peerComparison: peerComparison,\n      motivation: {\n        quote: 'å­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦è¯´ä¹ï¼Ÿ',\n        encouragement: level > 3 ? 'ä½ å·²ç»æ˜¯ä¸€ä¸ªä¼˜ç§€çš„å­¦ä¹ è€…äº†ï¼' : 'ç»§ç»­åŠªåŠ›ï¼Œä½ æ­£åœ¨è¿›æ­¥ï¼',\n        nextMilestone: milestones.find(m => !m.achieved)?.requirement || 'ç»§ç»­ä¿æŒä¼˜ç§€'\n      }\n    }\n  }\n};"
      },
      "id": "generate-growth-report",
      "name": "ç”Ÿæˆæˆé•¿æŠ¥å‘Š",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 400]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ $json }}"
      },
      "id": "respond-progress",
      "name": "è¿”å›è¿›åº¦æŠ¥å‘Š",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [900, 400]
    }
  ],
  "connections": {
    "webhook-progress-trigger": {
      "main": [
        [
          {
            "node": "å­¦ä¹ è¿›åº¦åˆ†æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å­¦ä¹ è¿›åº¦åˆ†æ": {
      "main": [
        [
          {
            "node": "ç”Ÿæˆæˆé•¿æŠ¥å‘Š",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ç”Ÿæˆæˆé•¿æŠ¥å‘Š": {
      "main": [
        [
          {
            "node": "è¿”å›è¿›åº¦æŠ¥å‘Š",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  }
}
